"use strict";const e=require("../common/vendor.js"),r=require("../config/index.js");const t=t=>new Promise(((o,n)=>{const s=(r=>{const t=e.index.getStorageSync("token");return t&&(r.header.Authorization=`Bearer ${t}`),"GET"===r.method&&(r.url+=(r.url.includes("?")?"&":"?")+`_t=${Date.now()}`),r})({url:r.requestConfig.baseURL+t.url,method:t.method||"GET",data:t.data||{},header:{...r.requestConfig.header,...t.header},timeout:t.timeout||r.requestConfig.timeout,success:e=>{try{const r=(e=>{const{statusCode:r,data:t}=e;if(200===r){if(200===t.code||0===t.code)return t.data||t;{const e=new Error(t.message||"请求失败");return e.data=t,Promise.reject(e)}}{const t=new Error(`网络错误: ${r}`);return t.statusCode=r,t.response=e,Promise.reject(t)}})(e);o(r)}catch(r){n(r)}},fail:e=>{const r=(e=>{if(console.error("请求错误:",e),e.errMsg){if(e.errMsg.includes("timeout")){const r=new Error("请求超时");return r.originalError=e,Promise.reject(r)}if(e.errMsg.includes("fail")){const r=new Error("网络连接失败");return r.originalError=e,Promise.reject(r)}}return Promise.reject(e)})(e);n(r)}});e.index.request(s)})),o=e=>e.catch((e=>Promise.reject(e))),n={get(e,r={},n={}){const s=function(e={}){return Object.keys(e).map((r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`)).join("&")}(r);return s&&(e+=(e.includes("?")?"&":"?")+s),o(t({url:e,method:"GET",...n}))},post:(e,r={},n={})=>o(t({url:e,method:"POST",data:r,...n})),put:(e,r={},n={})=>o(t({url:e,method:"PUT",data:r,...n})),delete:(e,r={},n={})=>o(t({url:e,method:"DELETE",data:r,...n}))};exports.http=n;
