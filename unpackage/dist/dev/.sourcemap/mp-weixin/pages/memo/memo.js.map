{"version":3,"file":"memo.js","sources":["pages/memo/memo.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVtby9tZW1vLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<uni-row class=\"content-row\" margin=\"0px\" v-for=\"memo in memoList\" :key=\"memo.id\">\r\n\t\t\t<uni-col :span=\"24\">\r\n\t\t\t\t<uni-card :title=\"memo.title\" :extra=\"memo.updatedAt\" @click=\"handleMemoClick(memo)\">\r\n\t\t\t\t\t<text class=\"uni-body\">{{memo.content}}</text>\r\n\t\t\t\t</uni-card>\r\n\t\t\t</uni-col>\r\n\t\t</uni-row>\r\n\t\t<!-- 无长度的情况 -->\r\n\t\t<view v-if=\"memoList.length === 0\" class=\"empty\">\r\n\t\t\t<text>暂无备忘录</text>\r\n\t\t</view>\r\n\t\t<!-- 分页器放底部 -->\r\n\t\t<view class=\"pagination-wrapper\">\r\n\t\t\t<uni-pagination class=\"pagination\" :show-icon=\"true\" :total=\"total\" :current=\"pageNum\" :page-size=\"pageSize\"\r\n\t\t\t\t@change=\"handlePageChange\" />\r\n\t\t\t<view class=\"pagination-right\">总条数：{{total}}</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue'\r\n\timport {\r\n\t\tsafeMemoApi\r\n\t} from '@/api/safeApi.js'\r\n\timport {\r\n\t\thandleAsync\r\n\t} from '@/utils/errorHandler.js'\r\n\t// 平台检查\r\n\tconst isH5 = process.env.VUE_APP_PLATFORM === 'h5'\r\n\tconst isMpWeixin = process.env.VUE_APP_PLATFORM === 'mp-weixin'\r\n\r\n\t// 安全的 DOM 操作函数\r\n\tconst safeQuerySelector = (selector) => {\r\n\t\tif (isH5 && typeof document !== 'undefined') {\r\n\t\t\treturn document.querySelector(selector)\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\tconst safeGetElementById = (id) => {\r\n\t\tif (isH5 && typeof document !== 'undefined') {\r\n\t\t\treturn document.getElementById(id)\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\t// 响应式数据\r\n\tconst memoList = ref([]) // memo列表\r\n\tconst loading = ref(false) // 加载状态\r\n\tconst total = ref(0) // 总条数\r\n\tconst pageNum = ref(1) // 分页器当前页数\r\n\tconst pageSize = ref(10) // 分页器一页条数\r\n\r\n\t// 加载备忘录列表\r\n\tconst loadMemoList = async () => {\r\n\t\tloading.value = true\r\n\t\tconst params = {\r\n\t\t\tpageNum: pageNum.value,\r\n\t\t\tpageSize: pageSize.value,\r\n\t\t\t// 后端从jwt获取用户ID，不再传uid\r\n\t\t\tcategoryIds: \"1,2\",\r\n\t\t\tkeyword: '' // 可以留空或填关键词\r\n\t\t}\r\n\r\n\t\tconst data = await safeMemoApi.getMemoList(params)\r\n\t\t// 自动处理报错\r\n\t\tif (data) {\r\n\t\t\ttotal.value = data.total\r\n\t\t\tconsole.log(data)\r\n\t\t\tmemoList.value = data?.records || [] // ⚠️ 注意分页结果在 data.records\r\n\t\t}\r\n\t\tloading.value = false\r\n\t}\r\n\t\r\n\t// 点击备忘录\r\n\tconst handleMemoClick = (memo) => {\r\n\t\t// 跳转到详情页\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `/pages/view/memoDetail/memoDetail?id=${memo.id}&title=${memo.title}`\r\n\t\t})\r\n\t}\r\n\r\n\t// 处理分页变化\r\n\tconst handlePageChange = (e) => {\r\n\t\tpageNum.value = e.current\r\n\t\t// 使用handleAsync包装异步操作\r\n\t\thandleAsync(\r\n\t\t\tasync () => {\r\n\t\t\t\tawait loadMemoList()\r\n\t\t\t\treturn {\r\n\t\t\t\t\tsuccess: true\r\n\t\t\t\t}\r\n\t\t\t}, {\r\n\t\t\t\tshowError: true,\r\n\t\t\t\terrorMsg: '加载分页数据失败',\r\n\t\t\t\tloading: false\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n\r\n\t// 页面加载时获取数据\r\n\tonMounted(() => {\r\n\t\tloadMemoList()\r\n\t})\r\n</script>\r\n\r\n<style scoped>\r\n\t.container {\r\n\t\tmin-height: calc(100vh);\r\n\t}\r\n\r\n\t/* 列表 */\r\n\t.container .content-row {\r\n\t\tflex: 1;\r\n\t\toverflow: auto;\r\n\t}\r\n\r\n\t/* 分页器 */\r\n\t.pagination-wrapper {\r\n\t\theight: 100rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\tbackground-color: #fff;\r\n\t\tposition: fixed;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\tz-index: 99;\r\n\t\tbox-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\r\n\t\tpadding: 0rpx 20rpx;\r\n\r\n\t\t/* 使用安全区适配底部 */\r\n\t\tbottom: calc(env(safe-area-inset-bottom));\r\n\t}\r\n\r\n\t.container .pagination-wrapper .pagination {\r\n\t\twidth: 60%;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t/* 内部样式改变 */\r\n\t.container .pagination-wrapper .pagination :deep(.uni-pagination) {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.container .pagination-wrapper .pagination-right {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tfont-size: 14px;\r\n\t}\r\n\r\n\r\n\t.empty {\r\n\t\ttext-align: center;\r\n\t\tpadding: 100rpx 0;\r\n\t\tcolor: #999;\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/PrivateProject/front/note/pages/memo/memo.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","safeMemoApi","uni","handleAsync","onMounted"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAoDO,UAAA,WAAWA,kBAAI,CAAA,CAAE;AACjB,UAAA,UAAUA,kBAAI,KAAK;AACnB,UAAA,QAAQA,kBAAI,CAAC;AACb,UAAA,UAAUA,kBAAI,CAAC;AACf,UAAA,WAAWA,kBAAI,EAAE;AAGvB,UAAM,eAAe,YAAY;AAChC,cAAQ,QAAQ;AAChB,YAAM,SAAS;AAAA,QACd,SAAS,QAAQ;AAAA,QACjB,UAAU,SAAS;AAAA;AAAA,QAEnB,aAAa;AAAA,QACb,SAAS;AAAA;AAAA,MAAA;AAGV,YAAM,OAAO,MAAMC,YAAAA,YAAY,YAAY,MAAM;AAEjD,UAAI,MAAM;AACT,cAAM,QAAQ,KAAK;AACPC,sBAAAA,MAAA,MAAA,OAAA,6BAAA,IAAI;AACP,iBAAA,SAAQ,6BAAM,YAAW,CAAA;AAAA,MACnC;AACA,cAAQ,QAAQ;AAAA,IAAA;AAIX,UAAA,kBAAkB,CAAC,SAAS;AAEjCA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,wCAAwC,KAAK,EAAE,UAAU,KAAK,KAAK;AAAA,MAAA,CACxE;AAAA,IAAA;AAII,UAAA,mBAAmB,CAAC,MAAM;AAC/B,cAAQ,QAAQ,EAAE;AAElBC,yBAAA;AAAA,QACC,YAAY;AACX,gBAAM,aAAa;AACZ,iBAAA;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,QAEX;AAAA,QAAG;AAAA,UACF,WAAW;AAAA,UACX,UAAU;AAAA,UACV,SAAS;AAAA,QACV;AAAA,MAAA;AAAA,IACD;AAIDC,kBAAAA,UAAU,MAAM;AACF;IAAA,CACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3GF,GAAG,WAAW,eAAe;"}