{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["/**\r\n * 网络请求封装\r\n * 基于 uni.request 实现跨平台请求\r\n */\r\n\r\nimport {\r\n\trequestConfig\r\n} from '@/config/index.js'\r\n// 工具函数：将对象转为查询字符串\r\nfunction serializeParams(params = {}) {\r\n\treturn Object.keys(params)\r\n\t\t.map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\r\n\t\t.join('&')\r\n}\r\n// 请求拦截器\r\nconst requestInterceptor = (options) => {\r\n\t// 添加 token\r\n\tconst token = uni.getStorageSync('token')\r\n\tif (token) {\r\n\t\toptions.header.Authorization = `Bearer ${token}`\r\n\t}\r\n\r\n\t// 添加时间戳防止缓存\r\n\tif (options.method === 'GET') {\r\n\t\toptions.url += (options.url.includes('?') ? '&' : '?') + `_t=${Date.now()}`\r\n\t}\r\n\r\n\treturn options\r\n}\r\n\r\n// 响应拦截器\r\nconst responseInterceptor = (response) => {\r\n\tconst {\r\n\t\tstatusCode,\r\n\t\tdata\r\n\t} = response\r\n\r\n\t// 请求成功\r\n\tif (statusCode === 200) {\r\n\t\t// 这里可以根据后端的响应格式调整\r\n\t\tif (data.code === 200 || data.code === 0) {\r\n\t\t\treturn data.data || data\r\n\t\t} else {\r\n\t\t\t// 业务错误\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: data.message || '请求失败',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t\treturn Promise.reject(data)\r\n\t\t}\r\n\t} else {\r\n\t\t// HTTP 错误\r\n\t\tuni.showToast({\r\n\t\t\ttitle: `网络错误: ${statusCode}`,\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t\treturn Promise.reject(response)\r\n\t}\r\n}\r\n\r\n// 错误处理\r\nconst errorHandler = (error) => {\r\n\tconsole.error('请求错误:', error)\r\n\r\n\t// 网络错误\r\n\tif (error.errMsg && error.errMsg.includes('timeout')) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '请求超时',\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t} else if (error.errMsg && error.errMsg.includes('fail')) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: '网络连接失败',\r\n\t\t\ticon: 'none'\r\n\t\t})\r\n\t}\r\n\r\n\treturn Promise.reject(error)\r\n}\r\n\r\n// 核心请求方法\r\nconst request = (options) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\t// 合并配置\r\n\t\tconst requestOptions = {\r\n\t\t\turl: requestConfig.baseURL + options.url,\r\n\t\t\tmethod: options.method || 'GET',\r\n\t\t\tdata: options.data || {},\r\n\t\t\theader: {\r\n\t\t\t\t...requestConfig.header,\r\n\t\t\t\t...options.header\r\n\t\t\t},\r\n\t\t\ttimeout: options.timeout || requestConfig.timeout,\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst result = responseInterceptor(res)\r\n\t\t\t\t\tresolve(result)\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\treject(error)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconst error = errorHandler(err)\r\n\t\t\t\treject(error)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 执行请求拦截器\r\n\t\tconst finalOptions = requestInterceptor(requestOptions)\r\n\r\n\t\t// 发起请求\r\n\t\tuni.request(finalOptions)\r\n\t})\r\n}\r\n\r\n// 便捷方法\r\nexport const http = {\r\n\t// GET 请求\r\n\tget(url, params = {}, options = {}) {\r\n\t\tconst query = serializeParams(params)\r\n\t\tif (query) {\r\n\t\t\turl += (url.includes('?') ? '&' : '?') + query\r\n\t\t}\r\n\t\treturn request({\r\n\t\t\turl,\r\n\t\t\tmethod: 'GET',\r\n\t\t\t...options\r\n\t\t})\r\n\t},\r\n\r\n\t// POST 请求\r\n\tpost(url, data = {}, options = {}) {\r\n\t\treturn request({\r\n\t\t\turl,\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata,\r\n\t\t\t...options\r\n\t\t})\r\n\t},\r\n\r\n\t// PUT 请求\r\n\tput(url, data = {}, options = {}) {\r\n\t\treturn request({\r\n\t\t\turl,\r\n\t\t\tmethod: 'PUT',\r\n\t\t\tdata,\r\n\t\t\t...options\r\n\t\t})\r\n\t},\r\n\r\n\t// DELETE 请求\r\n\tdelete(url, params = {}, options = {}) {\r\n\t\treturn request({\r\n\t\t\turl,\r\n\t\t\tmethod: 'DELETE',\r\n\t\t\tdata: params,\r\n\t\t\t...options\r\n\t\t})\r\n\t}\r\n}\r\n\r\n// 导出原始请求方法（如果需要）\r\nexport {\r\n\trequest\r\n}"],"names":["uni","requestConfig"],"mappings":"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"}