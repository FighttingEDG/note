"use strict";const o=require("../common/vendor.js"),n=async(n,e={})=>{const{showError:r=!0,errorMsg:t="操作失败",onError:i,onSuccess:s,rethrow:c=!1,loading:d=!1,loadingText:a="加载中..."}=e;try{d&&o.index.showLoading({title:a,mask:!0});const e=await n();return d&&o.index.hideLoading(),"function"==typeof s&&s(e),e}catch(h){if(d&&o.index.hideLoading(),r&&!h.handled){const n=h.message||t;o.index.showToast({title:n,icon:"none"}),h.handled=!0}if("function"==typeof i&&i(h),c)throw h;return null}};exports.createSafeApi=(o,e={})=>{const r={};for(const t in o)"function"==typeof o[t]?r[t]=(...r)=>{const i=r[r.length-1];if(i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&(void 0!==i.showError||void 0!==i.errorMsg||void 0!==i.onError||void 0!==i.onSuccess||void 0!==i.rethrow||void 0!==i.loading||void 0!==i.loadingText)&&r.length>0){const i=r.slice(0,-1),s=r[r.length-1],c={...e,...s};return n((()=>o[t](...i)),c)}return n((()=>o[t](...r)),e)}:r[t]=o[t];return r},exports.handleAsync=n;
