{"version":3,"file":"errorHandler.js","sources":["utils/errorHandler.js"],"sourcesContent":["/**\n * 全局错误处理工具\n * 用于包装API调用，避免每次都写try-catch\n */\n\n/**\n * 包装异步函数调用，统一处理错误\n * @param {Function} asyncFunc - 异步函数\n * @param {Object} options - 配置选项\n * @param {Boolean} options.showError - 是否显示错误提示，默认为true\n * @param {String} options.errorMsg - 自定义错误提示\n * @param {Function} options.onError - 错误回调函数\n * @param {Function} options.onSuccess - 成功回调函数\n * @param {Boolean} options.rethrow - 是否重新抛出错误，默认为false\n * @returns {Promise} 处理后的Promise\n */\nexport const handleAsync = async (asyncFunc, options = {}) => {\n  const {\n    showError = true,\n    errorMsg = '操作失败',\n    onError,\n    onSuccess,\n    rethrow = false,\n    loading = false,\n    loadingText = '加载中...',\n  } = options;\n  \n  try {\n    // 显示加载提示\n    if (loading) {\n      uni.showLoading({\n        title: loadingText,\n        mask: true\n      });\n    }\n    \n    // 执行异步函数\n    const result = await asyncFunc();\n    \n    // 隐藏加载提示\n    if (loading) {\n      uni.hideLoading();\n    }\n    \n    // 调用成功回调\n    if (typeof onSuccess === 'function') {\n      onSuccess(result);\n    }\n    \n    return result;\n  } catch (error) {\n    // 隐藏加载提示\n    if (loading) {\n      uni.hideLoading();\n    }\n    \n    // 显示错误提示\n    if (showError && !error.handled) {\n      // 优先使用后端返回的错误信息\n      const errorMessage = error.message || errorMsg;\n      uni.showToast({\n        title: errorMessage,\n        icon: 'none'\n      });\n      \n      // 标记错误已显示提示\n      error.handled = true;\n    }\n    \n    // 调用错误回调\n    if (typeof onError === 'function') {\n      onError(error);\n    }\n    \n    // 是否重新抛出错误\n    if (rethrow) {\n      throw error;\n    }\n    \n    // 返回null表示操作失败\n    return null;\n  }\n};\n\n/**\n * 创建一个包装后的API对象，所有方法都自动处理错误\n * @param {Object} api - 原始API对象\n * @param {Object} defaultOptions - 默认配置选项\n * @returns {Object} 包装后的API对象\n */\nexport const createSafeApi = (api, defaultOptions = {}) => {\n  const safeApi = {};\n  \n  for (const key in api) {\n    if (typeof api[key] === 'function') {\n      safeApi[key] = (...args) => {\n        // 检查最后一个参数是否为选项对象（自定义handleAsync选项）\n        const lastArg = args[args.length - 1];\n        const hasOptions = lastArg && typeof lastArg === 'object' && \n                          !Array.isArray(lastArg) && \n                          !(lastArg instanceof Date) &&\n                          (lastArg.showError !== undefined || \n                           lastArg.errorMsg !== undefined || \n                           lastArg.onError !== undefined || \n                           lastArg.onSuccess !== undefined || \n                           lastArg.rethrow !== undefined || \n                           lastArg.loading !== undefined || \n                           lastArg.loadingText !== undefined);\n        \n        if (hasOptions && args.length > 0) {\n          // 如果最后一个参数是handleAsync选项对象，则从参数中移除\n          const apiArgs = args.slice(0, -1);\n          const customOptions = args[args.length - 1];\n          \n          // 合并默认选项和自定义选项\n          const mergedOptions = { ...defaultOptions, ...customOptions };\n          \n          return handleAsync(() => api[key](...apiArgs), mergedOptions);\n        } else {\n          // 否则使用默认选项，将所有参数传递给原始API\n          return handleAsync(() => api[key](...args), defaultOptions);\n        }\n      };\n    } else {\n      safeApi[key] = api[key];\n    }\n  }\n  \n  return safeApi;\n};"],"names":["uni"],"mappings":";;AAgBY,MAAC,cAAc,OAAO,WAAW,UAAU,OAAO;AAC5D,QAAM;AAAA,IACJ,YAAY;AAAA,IACZ,WAAW;AAAA,IACX;AAAA,IACA;AAAA,IACA,UAAU;AAAA,IACV,UAAU;AAAA,IACV,cAAc;AAAA,EACf,IAAG;AAEJ,MAAI;AAEF,QAAI,SAAS;AACXA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,MAAM;AAAA,MACd,CAAO;AAAA,IACF;AAGD,UAAM,SAAS,MAAM;AAGrB,QAAI,SAAS;AACXA,oBAAG,MAAC,YAAW;AAAA,IAChB;AAGD,QAAI,OAAO,cAAc,YAAY;AACnC,gBAAU,MAAM;AAAA,IACjB;AAED,WAAO;AAAA,EACR,SAAQ,OAAO;AAEd,QAAI,SAAS;AACXA,oBAAG,MAAC,YAAW;AAAA,IAChB;AAGD,QAAI,aAAa,CAAC,MAAM,SAAS;AAE/B,YAAM,eAAe,MAAM,WAAW;AACtCA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACd,CAAO;AAGD,YAAM,UAAU;AAAA,IACjB;AAGD,QAAI,OAAO,YAAY,YAAY;AACjC,cAAQ,KAAK;AAAA,IACd;AAGD,QAAI,SAAS;AACX,YAAM;AAAA,IACP;AAGD,WAAO;AAAA,EACR;AACH;AAQY,MAAC,gBAAgB,CAAC,KAAK,iBAAiB,OAAO;AACzD,QAAM,UAAU,CAAA;AAEhB,aAAW,OAAO,KAAK;AACrB,QAAI,OAAO,IAAI,GAAG,MAAM,YAAY;AAClC,cAAQ,GAAG,IAAI,IAAI,SAAS;AAE1B,cAAM,UAAU,KAAK,KAAK,SAAS,CAAC;AACpC,cAAM,aAAa,WAAW,OAAO,YAAY,YAC/B,CAAC,MAAM,QAAQ,OAAO,KACtB,EAAE,mBAAmB,UACpB,QAAQ,cAAc,UACtB,QAAQ,aAAa,UACrB,QAAQ,YAAY,UACpB,QAAQ,cAAc,UACtB,QAAQ,YAAY,UACpB,QAAQ,YAAY,UACpB,QAAQ,gBAAgB;AAE3C,YAAI,cAAc,KAAK,SAAS,GAAG;AAEjC,gBAAM,UAAU,KAAK,MAAM,GAAG,EAAE;AAChC,gBAAM,gBAAgB,KAAK,KAAK,SAAS,CAAC;AAG1C,gBAAM,gBAAgB,EAAE,GAAG,gBAAgB,GAAG,cAAa;AAE3D,iBAAO,YAAY,MAAM,IAAI,GAAG,EAAE,GAAG,OAAO,GAAG,aAAa;AAAA,QACtE,OAAe;AAEL,iBAAO,YAAY,MAAM,IAAI,GAAG,EAAE,GAAG,IAAI,GAAG,cAAc;AAAA,QAC3D;AAAA,MACT;AAAA,IACA,OAAW;AACL,cAAQ,GAAG,IAAI,IAAI,GAAG;AAAA,IACvB;AAAA,EACF;AAED,SAAO;AACT;;;"}